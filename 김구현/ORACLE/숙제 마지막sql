--1) 전공과 전공별 기말고사 평균 점수를 갖는 테이블
--   T_MAJOR_AVG_RES를 생성하고 SCORE테이블과 STUDENT테이블을 참조해서
--   T_MAJOR_AVG_RES에 데이터를 저장하는 프로시저 P_MAJOR_AVG_RES를 생성하세요.
CREATE TABLE T_MAJOR_AVG_RES
(
    SNAME VARCHAR2(20),
    MAJOR VARCHAR2(20),
    AVG_RESULT NUMBER(5,2)
);

 DROP TABLE T_MAJOR_AVG_RES;
 
CREATE OR REPLACE PROCEDURE P_MAJOR_AVG_RES IS 
CURSOR CUR_MAJOR_AVG_RES IS
    SELECT 
        ST.SNAME,
        ST.MAJOR,
        TRUNC(AVG(SC.RESULT), 2) AS AVG_RESULT
    FROM SCORE SC 
    LEFT JOIN STUDENT ST ON SC.SNO = ST.SNO
    GROUP BY ST.SNAME,ST.MAJOR;

    V_SNAME STUDENT.MAJOR%TYPE;
    V_MAJOR STUDENT.MAJOR%TYPE;
    V_AVG_RESULT T_MAJOR_AVG_RES.AVG_RESULT%TYPE;
BEGIN
    DELETE FROM T_MAJOR_AVG_RES;
    
    OPEN CUR_MAJOR_AVG_RES;
        LOOP
            FETCH CUR_MAJOR_AVG_RES INTO V_SNAME,V_MAJOR,V_AVG_RESULT;
            EXIT WHEN CUR_MAJOR_AVG_RES%NOTFOUND;
            
            INSERT INTO T_MAJOR_AVG_RES(SNAME, MAJOR, AVG_RESULT)
            VALUES (V_SNAME,V_MAJOR,V_AVG_RESULT);
        END LOOP;
    CLOSE CUR_MAJOR_AVG_RES;
    COMMIT;
END;
/

BEGIN
 P_MAJOR_AVG_RES;
END;
/

SELECT * FROM T_MAJOR_AVG_RES;



--2) 교수들은 부임일로부터 5년마다 안식년을 갖습니다.
--   교수들의 오늘날짜까지의 안식년 횟수를 리턴하는 함수 F_GET_VACATION_CNT를 구현하세요.
CREATE OR REPLACE FUNCTION F_GET_VACATION_CNT
(
    HIREDATE DATE
)
RETURN NUMBER
IS
    F_YEARS NUMBER;
BEGIN
    F_YEARS := FLOOR((SYSDATE - HIREDATE)/1825);
    
    RETURN F_YEARS;
END;
/

SELECT PNO,PNAME,HIREDATE,F_GET_VACATION_CNT(HIREDATE) FROM PROFESSOR;















